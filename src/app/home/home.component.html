<div class="home-container" *ngIf="currentUser">
  <header class="header">
    <div class="header-content">
      <h1>Welcome Home!</h1>
      <button 
        class="logout-button" 
        (click)="logout()" 
        [disabled]="isLoading">
        <span *ngIf="!isLoading">Logout</span>
        <span *ngIf="isLoading">Logging out...</span>
      </button>
    </div>
  </header>

  <main class="main-content">
    <div class="profile-card">
      <div class="profile-header">
        <div class="avatar-section">
          <img 
            *ngIf="currentUser.picture" 
            [src]="currentUser.picture" 
            [alt]="currentUser.name + ' avatar'"
            class="avatar">
          <div 
            *ngIf="!currentUser.picture" 
            class="avatar-placeholder"
            [style.background]="getProviderColor()">
            {{ currentUser.name.charAt(0).toUpperCase() || 'U' }}
          </div>
          <div class="provider-badge" [style.border-color]="getProviderColor()">
            <span class="provider-icon">{{ getProviderIcon() }}</span>
            <span class="provider-text">{{ getProviderDisplayName() }}</span>
          </div>
        </div>
        <h2>{{ currentUser.name }}</h2>
        <p class="user-email">{{ currentUser.email }}</p>
      </div>

      <div class="profile-info">
        <h3>Account Information</h3>
        
        <div class="info-item">
          <span class="info-label">Display Name:</span>
          <span class="info-value">{{ currentUser.name }}</span>
        </div>
        
        <div class="info-item">
          <span class="info-label">Email:</span>
          <span class="info-value">{{ currentUser.email }}</span>
        </div>
        
        <div class="info-item">
          <span class="info-label">User ID:</span>
          <span class="info-value">{{ currentUser.id }}</span>
        </div>
        
        <div class="info-item">
          <span class="info-label">Authentication Provider:</span>
          <span class="info-value" [style.color]="getProviderColor()">
            {{ getProviderDisplayName() }}
          </span>
        </div>

        <!-- Microsoft-specific information -->
        <div *ngIf="currentProvider === 'microsoft'" class="provider-specific microsoft">
          <h3>Microsoft Account Details</h3>
          
          <div class="info-item" *ngIf="getMicrosoftProfile()?.username">
            <span class="info-label">Username:</span>
            <span class="info-value">{{ getMicrosoftProfile().username }}</span>
          </div>
          
          <div class="info-item" *ngIf="getMicrosoftProfile()?.tenantId">
            <span class="info-label">Tenant ID:</span>
            <span class="info-value">{{ getMicrosoftProfile().tenantId }}</span>
          </div>
          
          <div class="info-item" *ngIf="getMicrosoftProfile()?.homeAccountId">
            <span class="info-label">Home Account ID:</span>
            <span class="info-value">{{ getMicrosoftProfile().homeAccountId }}</span>
          </div>
          
          <!-- Token Claims (if available) -->
          <div *ngIf="getMicrosoftProfile()?.idTokenClaims" class="claims-section">
            <h4>Token Claims</h4>
            <div class="claims-grid">
              <div *ngIf="getMicrosoftProfile().idTokenClaims.given_name" class="claim-item">
                <span class="claim-label">Given Name:</span>
                <span class="claim-value">{{ getMicrosoftProfile().idTokenClaims.given_name }}</span>
              </div>
              <div *ngIf="getMicrosoftProfile().idTokenClaims.family_name" class="claim-item">
                <span class="claim-label">Family Name:</span>
                <span class="claim-value">{{ getMicrosoftProfile().idTokenClaims.family_name }}</span>
              </div>
              <div *ngIf="getMicrosoftProfile().idTokenClaims.preferred_username" class="claim-item">
                <span class="claim-label">Preferred Username:</span>
                <span class="claim-value">{{ getMicrosoftProfile().idTokenClaims.preferred_username }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Google-specific information -->
        <div *ngIf="currentProvider === 'google'" class="provider-specific google">
          <h3>Google Account Details</h3>
          
          <div class="info-item" *ngIf="getGoogleProfile()?.given_name">
            <span class="info-label">First Name:</span>
            <span class="info-value">{{ getGoogleProfile().given_name }}</span>
          </div>
          
          <div class="info-item" *ngIf="getGoogleProfile()?.family_name">
            <span class="info-label">Last Name:</span>
            <span class="info-value">{{ getGoogleProfile().family_name }}</span>
          </div>
          
          <div class="info-item" *ngIf="getGoogleProfile()?.verified_email !== undefined">
            <span class="info-label">Email Verified:</span>
            <span class="info-value" [class.verified]="getGoogleProfile().verified_email" 
                  [class.not-verified]="!getGoogleProfile().verified_email">
              {{ getGoogleProfile().verified_email ? 'Yes ✓' : 'No ✗' }}
            </span>
          </div>
          
          <div class="info-item" *ngIf="getGoogleProfile()?.locale">
            <span class="info-label">Locale:</span>
            <span class="info-value">{{ getGoogleProfile().locale }}</span>
          </div>
          
          <div class="info-item" *ngIf="getGoogleProfile()?.picture">
            <span class="info-label">Profile Picture:</span>
            <span class="info-value">Available</span>
          </div>
        </div>

        <!-- Raw Data (for debugging) -->
        <div class="raw-data-section">
          <details>
            <summary>Raw User Data (Debug)</summary>
            <pre class="raw-data">{{ currentUser.rawData | json }}</pre>
          </details>
        </div>
      </div>
    </div>
  </main>
</div>

<div class="loading-container" *ngIf="!currentUser && !isLoading">
  <div class="error-message">
    <p>You are not authenticated. Redirecting to login...</p>
  </div>
</div>

<div class="loading-container" *ngIf="isLoading">
  <div class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>
</div>